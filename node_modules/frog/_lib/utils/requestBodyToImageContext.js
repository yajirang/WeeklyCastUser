import { fromQuery } from './fromQuery.js';
import { getRequestUrl } from './getRequestUrl.js';
import * as jws from './jws.js';
export async function requestBodyToImageContext(c, { secret }) {
    const { previousState, previousButtonValues } = await (async () => {
        if (c.req.query()) {
            let { previousState, previousButtonValues } = fromQuery(c.req.query());
            if (secret && previousState)
                previousState = JSON.parse(await jws.verify(previousState, secret));
            return { previousState, previousButtonValues };
        }
        return {};
    })();
    const url = getRequestUrl(c.req);
    return {
        env: c.env,
        previousState,
        previousButtonValues,
        req: c.req,
        url: url.href,
        var: c.var,
    };
}
//# sourceMappingURL=requestBodyToImageContext.js.map